<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MeetYou</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<body class="container">
<h1 class="alert alert-success">MeetYou</h1>
<form method="post" id="regform">
    <div class="row">
        <div class="col">
            <input type="text" class="form-control" placeholder="Login" id="login">
        </div>
        <div class="col">
            <input type="password" class="form-control" placeholder="Password" id="password">
        </div>
        <div class="col">
            <input type="email" class="form-control" placeholder="email" id="email">
        </div>
        <input class="btn btn-primary" type="button" id="regbutton" value="Auth">
    </div>
</form>
<hr>
<form method="post" id="loginform">
    <div class="row">
        <div class="col">
            <input type="text" class="form-control" placeholder="Login" class="login">
        </div>
        <div class="col">
            <input type="password" class="form-control" placeholder="Password" class="password">
        </div>
        <input class="btn btn-primary" type="button" id="loginbutton" value="Auth">
    </div>
</form>
<h1> Create Chat form</h1>
<form method="post" id="chatcreateform">
    <div class="row">
        <div class="col">
            <input type="text" class="form-control" placeholder="title" id="chattitle">
        </div>
        <label for="memberlist">memberlist</label>
        <input type="text" class="form-control" value="[1,2,3]" id="memberlist">
        <label for="adminlist"></label>
        <input type="text" class="form-control" value="[5]" id="adminlist">
        <input class="btn btn-primary" type="button" id="chataddbutton" value="Auth">
    </div>
</form>
<h1> websocket example chat</h1>
Server URI: <input class="draw-border" id="uri" size="47" value="ws://localhost:8080/chat?id="
                   style="margin-bottom: 5px;">
<button class="btn btn-success" id="connect">Connect</button>
<button class="btn btn-danger mb-2" id="disconnect">Disconnect</button>

<pre id="messages" style="width: 600px; height: 400px; border: solid 1px #cccccc; margin-bottom: 5px;"></pre>

<div style="margin-bottom: 5px;">
    Message<br>
    <input class="draw-border" id="sendMessage" size="74" value="">
    <button class="echo-button" id="send">Send</button>
</div>
<script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
<script async>
    $(document).ready(function () {
        $(function () {
            $("#regbutton").click(function (e) {
                e.preventDefault();
                var formData = {
                    "login": $("#login").val()
                    , "password": $("#password").val()
                    , "email": $("#email").val()

                };
                $.ajax({
                    url: 'auth'
                    , type: 'POST'
                    , data: JSON.stringify(formData)
                    , success: function (res) {
                        alert(res);
                    }
                });
                return false;
            });
            $("#loginbutton").click(function (e) {
                e.preventDefault();
                var formData = {
                    "login": $("#login").val()
                    , "password": $("#password").val()

                };
                // let response = await fetch('/auth', {
                //     method: 'GET',
                //     body: JSON.stringify(formData)
                // });
                fetch("/auth", {
                    method: 'GET',
                    body: JSON.stringify(formData)
                })
                    .then(response => response.json())
                    .then(result => console.log(result))
                // $.ajax({
                //     url: 'auth',
                //     type: 'GET',
                //     xhrFields: {
                //         withCredentials: true
                //     },
                //     data: JSON.stringify(formData),
                //     success: function (res) {
                //         alert(res);
                //     }
                // });
                return false;
            });

            $("#chataddbutton").click(function (e) {
                e.preventDefault();
                var formData = {
                    "title": $("#chattitle").val()
                    , "members_list": $("#memberlist").val()
                    , "admin_list": $("#adminlist").val()

                };
                $.ajax({
                    url: 'chat'
                    , type: 'POST',
                    xhrFields: {
                        withCredentials: true
                    }
                    , data: JSON.stringify(formData)
                    , success: function (res) {
                        console.log()
                    }
                });
                return false;
            });
            var ws = null;

            connect.onclick = function () {
                ws = new WebSocket(uri.value);
                ws.onopen = function (ev) {
                    messages.innerText += "[connection opened]\n";
                };
                ws.onclose = function (ev) {
                    messages.innerText += "[connection closed]\n";
                };
                ws.onmessage = function (ev) {
                    messages.innerText += ev.data + "\n";
                };
                ws.onerror = function (ev) {
                    messages.innerText += "[error]\n";
                    console.log(ev);
                };
            };
            disconnect.onclick = function () {
                ws.close();
            };
            send.onclick = function () {
                ws.send(userName.value + ": " + sendMessage.value);
                sendMessage.value = "";
            };
            sendMessage.onkeyup = function (ev) {
                ev.preventDefault();
                if (event.keyCode === 13) {
                    send.click();
                }
            }
        });
    });
</script>
</body>
</html>